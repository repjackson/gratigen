head
    title Gratigen
    meta(name='viewport', content='user-scalable=yes, initial-scale=1.0, maximum-scale=2.0, width=device-width')
    meta(name='apple-mobile-web-app-capable', content='yes')
    meta(name='apple-mobile-web-app-status-bar-style', content='black')
    
    link(rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon.png")
    link(rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png")
    link(rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png")

    link(rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5")
    meta(name="apple-mobile-web-app-title" content="gratigen")
    meta(name="application-name" content="gratigen")
    meta(name="msapplication-TileColor" content="#da532c")
    meta(name="theme-color" content="#000000")
    
    
    
    link(rel='stylesheet' type='text/css' href='https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.0/dist/semantic.min.css')
    link(href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet")
    link(href="https://fonts.googleapis.com/css?family=Varela+Round&display=swap" rel="stylesheet")
    link(href="https://fonts.googleapis.com/css?family=Ubuntu:300,400&display=swap" rel="stylesheet")
    link(rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png")
    link(rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png")
    link(rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png")
    link(rel="manifest" href="/site.webmanifest")
    link(href="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/css/suneditor.min.css" rel="stylesheet")
    // link(rel='stylesheet', href='/layerslider/css/layerslider.css', type='text/css')
    // link(rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    //      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
    //      crossorigin="")

    // script(src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    //      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
    //      crossorigin="")
    // <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    // <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>


    link(rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css")

    
    
    // script(src='./qrcode.min.js')
    script(src='https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js')
    script(src='https://cdn.jsdelivr.net/npm/fomantic-ui@2.9.0/dist/semantic.min.js')
    
    // script(src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js')
    // link(href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet')
    
    // this one
    // script(src='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js')
    // link(href='https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css' rel='stylesheet')
    
    // script(src='https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.js')
    // link(href='https://api.mapbox.com/mapbox-gl-js/v2.6.0/mapbox-gl.css' rel='stylesheet')

    
    
    //- // External libraries: GreenSock
    // - /* script(src='/layerslider/js/jquery.js', type='text/javascript') */
    
    
    script(src="https://cdn.jsdelivr.net/npm/sweetalert2@9")
    script(src="https://cdn.jsdelivr.net/npm/suneditor@latest/dist/suneditor.min.js")
    script(src="https://cdn.jsdelivr.net/npm/suneditor@latest/src/lang/en.js")

    //- script(async='', src='https://www.googletagmanager.com/gtag/js?id=UA-140259454-1')
    script.
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'G-GLYPPRGJFQ');

    // script.
    //     $(window).on("load",function(){
    //         $(".loader-wrapper").fadeOut("slow");
    //     });
    script(type="module")
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
        const div = d3.selectAll("div");
    

body
    +leftbar
    +rightbar
    +global_modal
    +global_flyout
    // if currentUser.show_modelbar
    +modelbar
    .pusher
        +app


template(name='app')
    if Template.subscriptionsReady
        +nav
        // #draggable
        // if currentUser.show_leftbar
        // if currentUser.show_rightbar
        +delta_nav
        if currentUser.delta_id
            .ui.small.compact.attached.menu.hscroll
                .icon.item(title="#{doc_history.length} node history")
                    i.large.clock.icon(title='node history')
                each current_delta._doc_history.reverse
                    +doc_history_button
        .layout
            with currentUser
                if ct.length
                    +Template.dynamic template=current_delta._template
            else 
                +login
        +footer
    else 
        i.massive.asterisk.loading.blue.icon
    
template(name='doc_history_button')
    with doc_from_id
        .item.zoomer(title=model)
            a.goto_doc(title=model)
                with parent_model
                    +i name=icon color=stripped_icon_color cl='ui avatar image'
                if image_id
                    img.ui.mini.inline.rounded.image(src="{{c.url image_id width=300 height=300 gravity='face' crop='fill'}}")
                |{{truncated title}}
            i.remove.link.icon.delete_history_item.zoomer(title='remove history record')
    
template(name='global_flyout')
    with flyout_doc
        .ui.flyout
            i.close.icon
            .ui.header #{title}
            if image_id
                .image.content
                    img.ui.image(src="{{c.url image_id }}")
            .actions
                .ui.button hi



template(name='shortcut_modal')
    .ui.shortcut.modal
        .ui.header keyboard shortcuts
        .content
            .ui.large.list
                each shortcuts
                    .item 
                        .header #{combo}
                        .content #{action}


template(name='chart')
  svg#chart.chart

template(name='global_modal')
    with modal_doc
        .ui.modal.global
            .ui.header #{title}
            .content
                .ui.header #{body}
                .ui.label #{model}

template(name='footer')
    // if currentUser.admin_mode
    .ui.segment.grid
        .eight.wide.column.smallscroll
            .ui.header 
                i.shield.icon
                |footer 
            with current_delta
                +text_edit key='_template' label='_template' direct=true
                div
                +text_edit key='_model' label='_model' direct=true
                div
                +text_edit key='_doc_id' label='_doc_id' direct=true
                +boolean_edit key='show_leftbar' label='leftbar' direct=true
                +boolean_edit key='show_rightbar' label='rightbar' direct=true
                +boolean_edit key='show_modelbar' label='sidebar modelbar' icon='cubes' direct=true
                +boolean_edit key='show_secnav' label='secnav modelbar' icon='network' direct=true
                
            .ui.header 
                i.users.icon 
                |users
            each user_docs 
                .ui.large.button #{username}
        .eight.wide.column.smallscroll
            .ui.header 
                i.database.icon
                |docs 
            each doc_docs
                a.ui.compact.button(href="/m/#{model}/#{_id}") #{title} 
                    .ui.label
                        |#{model}
                            
                            
                        
template(name='add')
    .ui.padded.grid 
        .sixteen.wide.center.aligned.column
            .ui.header 
                i.large.play.icon 
                |add new doc
            each model_docs_helper 'model'
                    +add_model_doc_button 
            
template(name='add_model_doc_button')
    .ui.big.basic.button.add_model_doc.zoomer
        +i name=icon color=stripped_icon_color
        |#{title}
        
        
        
